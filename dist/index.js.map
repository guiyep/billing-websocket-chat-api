{"version":3,"sources":["../src/index.js"],"names":["server","http","createServer","PORT","wss","WebSocket","Server","sendMessage","ws","data","accountId","name","result","JSON","stringify","console","log","send","getMessage","msg","parsedMessage","parse","broadcastMessage","clients","forEach","client","readyState","OPEN","on","parseMessage","message","messageTypes","user","messageAdded","type","listen"],"mappings":"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","sourcesContent":["import WebSocket from 'ws';\nimport http from 'http';\nimport { addMessage, getAllMessagesForClient, getAllMessagesForUser } from './messages';\nimport messageTypes from './messagesTypes';\n\nconst server = http.createServer();\nconst PORT = 8080;\n\nconst wss = new WebSocket.Server({ server });\n\nconst sendMessage = (ws, data, accountId, name) => {\n  const result = JSON.stringify({ accountId, name, data });\n  console.log(`SENDING - ${result}`);\n  ws.send(result);\n};\n\nconst getMessage = (msg) => {\n  console.log(`RECEIVED - ${msg}`);\n  const parsedMessage = JSON.parse(msg);\n  return parsedMessage;\n};\n\nconst broadcastMessage = (ws, data, accountId, name) => {\n  wss.clients.forEach((client) => {\n    if (client !== ws && client.readyState === WebSocket.OPEN) {\n      console.log(`BROADCASTING - messaging to ${accountId} ${name}`);\n      sendMessage(client, data, accountId, name);\n    }\n  });\n};\n\nwss.on('connection', (ws) => {\n  console.log('CONNECTION - Someone is connected to the WEBSOCKET');\n\n  ws.on('message', (msg) => {\n    if (msg) {\n      const parseMessage = getMessage(msg);\n\n      if (parseMessage.name == 'CONNECT-ACCOUNT') {\n        const accountId = parseMessage.message;\n        sendMessage(ws, getAllMessagesForUser(accountId), accountId, messageTypes.user);\n      }\n\n      if (parseMessage.name == 'GET-ALL-MESSAGES-CLIENT') {\n        sendMessage(ws, getAllMessagesForClient(), '', messageTypes.client);\n      }\n\n      if (parseMessage.name == 'ADD-MESSAGE') {\n        const accountId = parseMessage.message.accountId;\n        const messageAdded = addMessage(accountId, parseMessage);\n        broadcastMessage(ws, messageAdded, accountId, 'NEW-MESSAGE-ADDED');\n        if (parseMessage.type === messageTypes.client) {\n          sendMessage(ws, getAllMessagesForClient(), messageTypes.client);\n        }\n      }\n    }\n  });\n});\n\nserver.listen(PORT);\n\nconsole.log(`listening ws://localhost:8080`);\n"],"file":"index.js"}